<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT">










<meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Hexo">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/">





  <title>Hexo</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Hexo</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/11/14/在服务器上部署shadowsocks服务/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="jackfrow">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/11/14/在服务器上部署shadowsocks服务/" itemprop="url">服务端部署shadowsocks</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-11-14T14:09:01+08:00">
                2019-11-14
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/工具/" itemprop="url" rel="index">
                    <span itemprop="name">工具</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h4><p>​        对于技术人员来说，网上查资料解决问题已经是非常重要的一个环节，谷歌的引擎搜索准确度也是世界上的顶尖水平，但是由于国内不能直接访问谷歌，所以出现了一些可以翻墙的技术和工具,shadowsocks就是其中之一。</p>
<h4 id="安装shadowsocks服务"><a href="#安装shadowsocks服务" class="headerlink" title="安装shadowsocks服务"></a>安装shadowsocks服务</h4><p>​      话不多说，直接进入正题。</p>
<h5 id="安装pip"><a href="#安装pip" class="headerlink" title="安装pip"></a>安装pip</h5><p>​      如果你的操作系统是Centos，可以使用以下命令:</p>
   <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install python-setuptools &amp;&amp; easy_install pip</span><br></pre></td></tr></table></figure>

<p>​     如果你的操作系统是Debian或者Ubuntu,可以使用以下命令 :</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-get install python-pip</span><br></pre></td></tr></table></figure>

<h5 id="安装shadowsocks"><a href="#安装shadowsocks" class="headerlink" title="安装shadowsocks"></a>安装shadowsocks</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install shadowsocks</span><br></pre></td></tr></table></figure>

<h5 id="配置shadowsocks"><a href="#配置shadowsocks" class="headerlink" title="配置shadowsocks"></a>配置<strong>shadowsocks</strong></h5><p>在/etc/shadowsocks 文件夹下（如果没有改文件夹，则使用 <em>mkdir /etc/shadowsocks</em> 命令新建一个文件夹）新建一个配置文件config.json，并写入如下命令：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line"></span><br><span class="line"><span class="string">"server"</span>:<span class="string">"0.0.0.0"</span>,</span><br><span class="line"></span><br><span class="line"><span class="string">"server_port"</span>:1234,</span><br><span class="line"></span><br><span class="line"><span class="string">"local_address"</span>:<span class="string">"127.0.0.1"</span>,</span><br><span class="line"></span><br><span class="line"><span class="string">"local_port"</span>:1080,</span><br><span class="line"><span class="string">"password"</span>:<span class="string">"******"</span>,</span><br><span class="line"></span><br><span class="line"><span class="string">"timeout"</span>:300,</span><br><span class="line"></span><br><span class="line"><span class="string">"method"</span>:<span class="string">"aes-256-cfb"</span>,</span><br><span class="line"></span><br><span class="line"><span class="string">"fast_open"</span>:<span class="literal">false</span>,</span><br><span class="line"></span><br><span class="line"><span class="string">"workers"</span>: 1</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>主要参数说明</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line"><span class="string">"server"</span>:<span class="string">""</span>,     <span class="comment">##服务器ip地址</span></span><br><span class="line"><span class="string">"server_port"</span>:1234,  <span class="comment">##代理端口</span></span><br><span class="line"><span class="string">"local_address"</span>:<span class="string">"127.0.0.1"</span>,</span><br><span class="line"><span class="string">"local_port"</span>:1080, <span class="comment">##本地监听端口</span></span><br><span class="line"><span class="string">"password"</span>:<span class="string">"******"</span>,   <span class="comment">##连接密码</span></span><br><span class="line"><span class="string">"timeout"</span>:300,</span><br><span class="line"><span class="string">"method"</span>:<span class="string">"aes-256-cfb"</span>, <span class="comment">##加密方式</span></span><br><span class="line"><span class="string">"dast_open"</span>:<span class="literal">false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="shadowsocks的启动与关闭"><a href="#shadowsocks的启动与关闭" class="headerlink" title="shadowsocks的启动与关闭"></a>shadowsocks的启动与关闭</h5><ul>
<li>使用 <em>ssserver -c /etc/shadowsocks/config.json -d start</em> 命令启动</li>
<li>使用 <em>netstat -tunlp</em> 命令查看</li>
<li>使用<em>ssserver -c /etc/shadowsocks/config.json -d stop</em>命令停止</li>
</ul>
<h5 id="连接shadowsocks"><a href="#连接shadowsocks" class="headerlink" title="连接shadowsocks"></a>连接shadowsocks</h5><p>​    下载一个shadowsocks的客户端(mac版本):<a href="https://github.com/shadowsocks/ShadowsocksX-NG/releases/" target="_blank" rel="noopener">shadowsocks</a></p>
<p>​    打开shadowsocks的客户端,配置服务器IP地址、服务器端口，密码、以及加密方式点击确认即可</p>
<p><img src="https://tva1.sinaimg.cn/large/006y8mN6gy1g8xk945qrpj30i60k8dh6.jpg" alt="image-20191114143926410"></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/10/31/Runtime总结/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="jackfrow">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/10/31/Runtime总结/" itemprop="url">runtime总结</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-10-31T20:00:01+08:00">
                2019-10-31
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/学习笔记/" itemprop="url" rel="index">
                    <span itemprop="name">学习笔记</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h4><p>​    晚上关于runtime的文章有很多，但是却几乎都是在讲怎么用，并没有讲清楚原理。所以在学习了很多关于runtime的知识之后，打算自己总结一下。</p>
<h4 id="runtime是什么？"><a href="#runtime是什么？" class="headerlink" title="runtime是什么？"></a>runtime是什么？</h4><p>​    首先，runtime是明确实体是一个库，名字叫runtime，![image-20191031200820268](/Users/jackfrow/Library/Application Support/typora-user-images/image-20191031200820268.png)。</p>
<h4 id="有什么用？"><a href="#有什么用？" class="headerlink" title="有什么用？"></a>有什么用？</h4><p>   在OC中，95%的代码都是用C语言写的，剩下的就是一个runtime，说到底，oc的方法调用到最后都是调用一个函数，但是通过runtime这个系统库，它把寻找函数调用的通过封装到了runtime里面，于是OC就从C语言多了对象的概念，有了发消息的概念，说到底，就是让我们在编程时，有了不同的编程思维感受，能够更加方便的完成任务。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/09/09/AVFoundation总结/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="jackfrow">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/09/09/AVFoundation总结/" itemprop="url">AVFoundation总结</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-09-09T10:42:49+08:00">
                2019-09-09
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/学习总结/" itemprop="url" rel="index">
                    <span itemprop="name">学习总结</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="框架简介"><a href="#框架简介" class="headerlink" title="框架简介"></a>框架简介</h4><blockquote>
<p>AVFoundation是iOS中用于处理音视频的框架，主要提供的功能有，视屏播放，视屏录制，以及视屏编辑等功能。</p>
</blockquote>
<h4 id="概念介绍"><a href="#概念介绍" class="headerlink" title="概念介绍"></a>概念介绍</h4><h5 id="AVAsset"><a href="#AVAsset" class="headerlink" title="AVAsset"></a>AVAsset</h5><blockquote>
<p>AVAsset是AVFoundation框架中抽象类，用来表示音频或者视屏资源,是一组音视频资源的类型,其中比较重要的属性有duration（持续时间）,tracks（资源轨道）。</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> asset = <span class="type">AVAsset</span>(url: url)</span><br></pre></td></tr></table></figure>

<h5 id="AVPlayer"><a href="#AVPlayer" class="headerlink" title="AVPlayer"></a>AVPlayer</h5><blockquote>
<p>An object that provides the interface to control the player’s transport behavior.</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> player = <span class="type">AVPlayer</span>(playerItem: &lt;#<span class="type">T</span>##<span class="type">AVPlayerItem?</span>#&gt;)<span class="comment">//初始化</span></span><br><span class="line"> player.seek(to: <span class="type">CMTime</span>.zero) <span class="comment">//跳转到播放位置</span></span><br><span class="line"> player.play()<span class="comment">//开始播放</span></span><br><span class="line"> player.pause()<span class="comment">//暂停</span></span><br></pre></td></tr></table></figure>

<h5 id="AVPlayerItem"><a href="#AVPlayerItem" class="headerlink" title="AVPlayerItem"></a>AVPlayerItem</h5><blockquote>
<p>该类主要是用于管理资源对象，提供播放数据源，旨在表示由AVPlayer播放的资产的呈现状态，并允许观察该状态，它控制着视频从创建到销毁的诸多状态。</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> playItem = <span class="type">AVPlayerItem</span>(asset: &lt;#<span class="type">T</span>##<span class="type">AVAsset</span>#&gt;)</span><br></pre></td></tr></table></figure>

<h5 id="AVPlayerLayer"><a href="#AVPlayerLayer" class="headerlink" title="AVPlayerLayer"></a>AVPlayerLayer</h5><blockquote>
<p>用于显示视频内容，相当于大屏幕。里面有videoGravity，默认值 AVLayerVideoGravityResizeAspect.</p>
</blockquote>
<h5 id="AVAssetTrack"><a href="#AVAssetTrack" class="headerlink" title="AVAssetTrack"></a>AVAssetTrack</h5><blockquote>
<p>AVAssetTrack是资源轨道，用于获取AVAsset中的资源，并加以处理</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//获取视屏资源中的视屏轨道(视屏交叉部分就会有多条轨道,这里只取第一条)</span></span><br><span class="line"><span class="keyword">guard</span> <span class="keyword">let</span> assetTrack = asset.tracks(withMediaType: .video).first <span class="keyword">else</span> &#123;<span class="keyword">continue</span> &#125;</span><br></pre></td></tr></table></figure>

<p>多条轨道与显示的关系：</p>
<p><img src="https://tva1.sinaimg.cn/large/006y8mN6gy1g6wo934s59j30kf05vjrq.jpg" alt="DC9D6C74-F6D8-4D71-8456-7673C2F6353F"></p>
<h5 id="AVVideoCompositionInstruction"><a href="#AVVideoCompositionInstruction" class="headerlink" title="AVVideoCompositionInstruction"></a>AVVideoCompositionInstruction</h5><blockquote>
<p>可以用作每段处理视屏的指令。</p>
</blockquote>
<h5 id="AVVideoCompositionLayerInstruction"><a href="#AVVideoCompositionLayerInstruction" class="headerlink" title="AVVideoCompositionLayerInstruction"></a>AVVideoCompositionLayerInstruction</h5><blockquote>
<p>用于显示界面的layer层,上图中可以看到1.2共存的部分,便会有多个LayerInstruction,就是一个资源中有多个轨道,并且轨道相交的部分就会产生多个LayerInstruction。</p>
</blockquote>
<h5 id="AVAssetExportSession"><a href="#AVAssetExportSession" class="headerlink" title="AVAssetExportSession"></a>AVAssetExportSession</h5><blockquote>
<p>针对AVAsset源对象的内容进行转码，创建一个被指定输出形式的资源。</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// MARK: - 导出合成的视频</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">export</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">let</span> session = <span class="type">AVAssetExportSession</span>.<span class="keyword">init</span>(asset: compostion.copy() <span class="keyword">as</span>! <span class="type">AVAsset</span>, presetName: <span class="type">AVAssetExportPreset1920x1080</span>)</span><br><span class="line">    </span><br><span class="line">    session?.outputURL = <span class="type">JRVideoEditor</span>.createTemplateFileURL()</span><br><span class="line">    session?.outputFileType = <span class="type">AVFileType</span>.mp4</span><br><span class="line">    session?.videoComposition = videoComposition</span><br><span class="line">    </span><br><span class="line">    session?.exportAsynchronously(completionHandler: &#123;[<span class="keyword">weak</span> <span class="keyword">self</span>] <span class="keyword">in</span></span><br><span class="line">        <span class="keyword">guard</span> <span class="keyword">let</span> strongSelf = <span class="keyword">self</span> <span class="keyword">else</span> &#123;<span class="keyword">return</span>&#125;</span><br><span class="line">        <span class="keyword">let</span> status = session?.status</span><br><span class="line">        <span class="keyword">if</span> status == <span class="type">AVAssetExportSession</span>.<span class="type">Status</span>.completed &#123;</span><br><span class="line">            strongSelf.saveToAlbum(atURL: session!.outputURL!, complete: &#123; (success) <span class="keyword">in</span></span><br><span class="line">                <span class="type">DispatchQueue</span>.main.async &#123;</span><br><span class="line">                   strongSelf.showSaveResult(isSuccess: success)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
</blockquote>
<h5 id="AVMutableComposition"><a href="#AVMutableComposition" class="headerlink" title="AVMutableComposition"></a>AVMutableComposition</h5><blockquote>
<p>AVAsset的子类，可以用来新建视屏轨道，音频轨道，提取出资源中音频资源，视屏资源。</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> composition = <span class="type">AVMutableComposition</span>()</span><br><span class="line"><span class="comment">//新建一条视屏轨道</span></span><br><span class="line"> <span class="keyword">guard</span> <span class="keyword">let</span> trackA = compostion.addMutableTrack(withMediaType: .video, preferredTrackID: trackId) <span class="keyword">else</span> &#123;<span class="keyword">return</span>&#125;</span><br><span class="line"><span class="comment">//提取视屏资源</span></span><br><span class="line"><span class="keyword">let</span> videoComposition = <span class="type">AVMutableVideoComposition</span>(propertiesOf: composition)</span><br></pre></td></tr></table></figure>

<p><img src="https://tva1.sinaimg.cn/large/006y8mN6gy1g72g8fm2u4j30l50e3jw0.jpg" alt="AVFoundation编辑结构图"></p>
<h4 id="实战场景"><a href="#实战场景" class="headerlink" title="实战场景"></a>实战场景</h4><h5 id="视屏播放"><a href="#视屏播放" class="headerlink" title="视屏播放"></a>视屏播放</h5><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">guard</span> <span class="keyword">let</span> string = <span class="type">Bundle</span>.main.path(forResource: <span class="string">"01_nebula"</span>, ofType: <span class="string">"mp4"</span>)<span class="keyword">else</span>&#123;</span><br><span class="line">     <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">let</span> url = <span class="type">URL</span>(fileURLWithPath: string)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> asset = <span class="type">AVAsset</span>(url: url)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> playItem = <span class="type">AVPlayerItem</span>(asset: asset)</span><br><span class="line"></span><br><span class="line">   player = <span class="type">AVPlayer</span>(playerItem: playItem)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> layer = <span class="type">AVPlayerLayer</span>(player: player)</span><br><span class="line">  </span><br><span class="line">  layer.frame = view.bounds</span><br><span class="line">  </span><br><span class="line">  view.layer.addSublayer(layer)</span><br><span class="line">  </span><br><span class="line">  player.play()</span><br></pre></td></tr></table></figure>

<h5 id="视屏拼接"><a href="#视屏拼接" class="headerlink" title="视屏拼接"></a>视屏拼接</h5><p>视屏拼接主要需要一条视频轨道用来存放视屏资源的数据。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">buildVideoTrack</span><span class="params">()</span></span>  &#123;</span><br><span class="line">       </span><br><span class="line">       <span class="comment">//使用invalid，系统会自动分配一个有效的trackId</span></span><br><span class="line">       <span class="keyword">let</span> trackId = kCMPersistentTrackID_Invalid</span><br><span class="line">       </span><br><span class="line">       <span class="keyword">guard</span> <span class="keyword">let</span> track = composition.addMutableTrack(withMediaType: .video, preferredTrackID: trackId) <span class="keyword">else</span> &#123;</span><br><span class="line">           <span class="keyword">return</span></span><br><span class="line">       &#125;</span><br><span class="line">       <span class="comment">//视频片段插入时间轴时的起始点</span></span><br><span class="line">       <span class="keyword">var</span> cursorTime = <span class="type">CMTime</span>.zero</span><br><span class="line">       </span><br><span class="line">       <span class="keyword">for</span> asset <span class="keyword">in</span> videos &#123;</span><br><span class="line">            <span class="comment">//获取视频资源中的视频轨道</span></span><br><span class="line">           <span class="keyword">guard</span> <span class="keyword">let</span> assetTrack = asset.tracks(withMediaType: .video).first <span class="keyword">else</span> &#123;</span><br><span class="line">               <span class="keyword">continue</span></span><br><span class="line">           &#125;</span><br><span class="line">           </span><br><span class="line">           <span class="keyword">do</span> &#123;</span><br><span class="line">               <span class="keyword">try</span> track.insertTimeRange(<span class="type">CMTimeRange</span>(start: .zero, duration: asset.duration), of: assetTrack, at: cursorTime)</span><br><span class="line">               <span class="comment">//光标移动到视频末尾处，以便插入下一段视频</span></span><br><span class="line">                 cursorTime = <span class="type">CMTimeAdd</span>(cursorTime, asset.duration)</span><br><span class="line">           &#125; <span class="keyword">catch</span>  &#123;</span><br><span class="line">               <span class="built_in">print</span>(<span class="string">"insert error"</span>)</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">       </span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<h5 id="添加水印-amp-添加动画"><a href="#添加水印-amp-添加动画" class="headerlink" title="添加水印&amp;添加动画"></a>添加水印&amp;添加动画</h5><p>要想对视屏资源进行添加效果，主要是需要对AVMutableVideoComposition的animationTool属性进行处理。</p>
<blockquote>
<p>水印代码</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// 1 - Set up the text layer</span></span><br><span class="line">    <span class="keyword">let</span> subtitle1Text = <span class="type">CATextLayer</span>()</span><br><span class="line">    subtitle1Text.font = <span class="string">"Helvetica-Bold"</span> <span class="keyword">as</span> <span class="type">CFTypeRef</span></span><br><span class="line">    subtitle1Text.fontSize = <span class="number">36</span></span><br><span class="line">    subtitle1Text.frame = <span class="type">CGRect</span>(x: <span class="number">0</span>, y: <span class="number">0</span>, width: size.width, height: <span class="number">100</span>)</span><br><span class="line">    subtitle1Text.string = <span class="string">"jackfrow"</span></span><br><span class="line">    subtitle1Text.alignmentMode = .center</span><br><span class="line">    subtitle1Text.foregroundColor = <span class="type">UIColor</span>.white.cgColor</span><br><span class="line"></span><br><span class="line">    <span class="comment">//2 - The usual overlay</span></span><br><span class="line">    <span class="keyword">let</span> overlayLayer = <span class="type">CALayer</span>()</span><br><span class="line">    overlayLayer.addSublayer(subtitle1Text)</span><br><span class="line">    overlayLayer.frame = <span class="type">CGRect</span>(x: <span class="number">0</span>, y: <span class="number">0</span>, width: size.width, height: size.height)</span><br><span class="line">    overlayLayer.masksToBounds = <span class="literal">true</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">let</span> parentLayer = <span class="type">CALayer</span>()</span><br><span class="line">    <span class="keyword">let</span> videoLayer = <span class="type">CALayer</span>()</span><br><span class="line">    </span><br><span class="line">    parentLayer.frame = <span class="type">CGRect</span>(x: <span class="number">0</span>, y: <span class="number">0</span>, width: size.width, height: size.height)</span><br><span class="line">    videoLayer.frame = <span class="type">CGRect</span>(x: <span class="number">0</span>, y: <span class="number">0</span>, width: size.width, height: size.height)</span><br><span class="line">    </span><br><span class="line">    parentLayer.addSublayer(videoLayer)</span><br><span class="line">    parentLayer.addSublayer(overlayLayer)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 3 - apply magic</span></span><br><span class="line">    composition.animationTool = <span class="type">AVVideoCompositionCoreAnimationTool</span>(postProcessingAsVideoLayer: videoLayer, <span class="keyword">in</span>: parentLayer)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>动画代码</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1.overlay</span></span><br><span class="line">      <span class="keyword">let</span> animationImage = <span class="type">UIImage</span>(named: <span class="string">"star.png"</span>)</span><br><span class="line">      <span class="keyword">let</span> overlayLayer1 = <span class="type">CALayer</span>()</span><br><span class="line">      overlayLayer1.contents = animationImage?.cgImage</span><br><span class="line">      overlayLayer1.frame = <span class="type">CGRect</span>(x: size.width/<span class="number">2</span> - <span class="number">64</span>, y: size.height/<span class="number">2</span> + <span class="number">200</span>, width:<span class="number">128</span>, height: <span class="number">128</span>)</span><br><span class="line">      overlayLayer1.masksToBounds = <span class="literal">true</span></span><br><span class="line">      </span><br><span class="line">      <span class="keyword">let</span> overlayLayer2 = <span class="type">CALayer</span>()</span><br><span class="line">      overlayLayer2.contents = animationImage?.cgImage</span><br><span class="line">      overlayLayer2.frame = <span class="type">CGRect</span>(x: size.width/<span class="number">2</span> - <span class="number">64</span> , y: size.height/<span class="number">2</span> - <span class="number">200</span>, width: <span class="number">128</span>, height: <span class="number">128</span>)</span><br><span class="line">      overlayLayer2.masksToBounds = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//2.3 - Twinkle</span></span><br><span class="line">    <span class="keyword">let</span> animationScale = <span class="type">CABasicAnimation</span>(keyPath: <span class="string">"transform.scale"</span>)</span><br><span class="line">          animationScale.duration = <span class="number">1.0</span></span><br><span class="line">          animationScale.repeatCount = <span class="number">5</span></span><br><span class="line">          animationScale.autoreverses = <span class="literal">true</span></span><br><span class="line">           <span class="comment">//  // animate from half size to full size</span></span><br><span class="line">    animationScale.fromValue = <span class="type">NSNumber</span>(floatLiteral: <span class="number">0.5</span>)</span><br><span class="line">    animationScale.toValue = <span class="type">NSNumber</span>(floatLiteral: <span class="number">1.0</span>)</span><br><span class="line">    animationScale.beginTime = <span class="type">AVCoreAnimationBeginTimeAtZero</span></span><br><span class="line">      </span><br><span class="line">    overlayLayer1.add(animationScale, forKey: <span class="string">"scale"</span>)</span><br><span class="line">    overlayLayer2.add(animationScale, forKey: <span class="string">"scale"</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//3 - Composition</span></span><br><span class="line">    <span class="keyword">let</span> parentLayer = <span class="type">CALayer</span>()</span><br><span class="line">    <span class="keyword">let</span> videoLayer = <span class="type">CALayer</span>()</span><br><span class="line">    parentLayer.frame = <span class="type">CGRect</span>(x: <span class="number">0</span>, y: <span class="number">0</span>, width: size.width, height: size.height)</span><br><span class="line">    videoLayer.frame = <span class="type">CGRect</span>(x: <span class="number">0</span>, y: <span class="number">0</span>, width: size.width, height: size.height)</span><br><span class="line">    parentLayer.addSublayer(videoLayer)</span><br><span class="line">    parentLayer.addSublayer(overlayLayer1)</span><br><span class="line">    parentLayer.addSublayer(overlayLayer2)</span><br><span class="line">    </span><br><span class="line">    composition.animationTool = <span class="type">AVVideoCompositionCoreAnimationTool</span>(postProcessingAsVideoLayer: videoLayer, <span class="keyword">in</span>: parentLayer)</span><br></pre></td></tr></table></figure>

<h5 id="过渡效果"><a href="#过渡效果" class="headerlink" title="过渡效果"></a>过渡效果</h5><p>一段视屏资源播放出来主要是由它在视屏资源轨道中资源来决定的，效果类似于上图。</p>
<p>所以要想实现视屏的过渡效果，主要是需要多条视屏轨道交叉播放，然后对轨道交叉部分做一定的处理，就可以实现视屏的过渡效果。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">///创建两条相交的视屏轨道  </span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">buildCompositionVideoTracks</span><span class="params">()</span></span>  &#123;</span><br><span class="line">       <span class="comment">//使用invalid，系统会自动分配一个有效的trackId</span></span><br><span class="line">        <span class="keyword">let</span> trackId = kCMPersistentTrackID_Invalid</span><br><span class="line">        <span class="comment">//创建AB两条视频轨道，视频片段交叉插入到轨道中，通过对两条轨道的叠加编辑各种效果。如0-5秒内，A轨道内容alpha逐渐到0，B轨道内容alpha逐渐到1</span></span><br><span class="line">        <span class="keyword">guard</span> <span class="keyword">let</span> trackA = composition.addMutableTrack(withMediaType: .video, preferredTrackID: trackId) <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">guard</span> <span class="keyword">let</span> trackB = composition.addMutableTrack(withMediaType: .video, preferredTrackID: trackId) <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">let</span> videoTracks = [trackA,trackB]</span><br><span class="line">     <span class="comment">//视频片段插入时间轴时的起始点</span></span><br><span class="line">        <span class="keyword">var</span> cursorTime = <span class="type">CMTime</span>.zero</span><br><span class="line">        <span class="comment">//转场动画时间</span></span><br><span class="line">        <span class="keyword">let</span> transitionDuration = <span class="type">CMTime</span>(value: <span class="number">2</span>, timescale: <span class="number">1</span>)</span><br><span class="line">        <span class="keyword">for</span> (index,value) <span class="keyword">in</span> assets.enumerated() &#123;</span><br><span class="line">            <span class="comment">//交叉循环A，B轨道</span></span><br><span class="line">            <span class="keyword">let</span> trackIndex = index % <span class="number">2</span></span><br><span class="line">            <span class="keyword">let</span> currentTrack = videoTracks[trackIndex]</span><br><span class="line">            <span class="comment">//获取视频资源中的视频轨道</span></span><br><span class="line">            <span class="keyword">guard</span> <span class="keyword">let</span> assetTrack = value.tracks(withMediaType: .video).first <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">do</span> &#123;</span><br><span class="line">                <span class="comment">//插入提取的视频轨道到 空白(编辑)轨道的指定位置中</span></span><br><span class="line">                <span class="keyword">try</span> currentTrack.insertTimeRange(<span class="type">CMTimeRange</span>(start: .zero, duration: value.duration), of: assetTrack, at: cursorTime)</span><br><span class="line">                <span class="comment">//光标移动到视频末尾处，以便插入下一段视频</span></span><br><span class="line">                cursorTime = <span class="type">CMTimeAdd</span>(cursorTime, value.duration)</span><br><span class="line">                <span class="comment">//光标回退转场动画时长的距离，这一段前后视频重叠部分组合成转场动画</span></span><br><span class="line">                cursorTime = <span class="type">CMTimeSubtract</span>(cursorTime, transitionDuration)</span><br><span class="line">            &#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">                </span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/// 设置转场动画</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">setupTransition</span><span class="params">(<span class="keyword">for</span> instruction: AVMutableVideoCompositionInstruction, fromLayer: AVMutableVideoCompositionLayerInstruction, toLayer: AVMutableVideoCompositionLayerInstruction ,type: TransitionType)</span></span> &#123;</span><br><span class="line">        <span class="keyword">let</span> identityTransform = <span class="type">CGAffineTransform</span>.identity</span><br><span class="line">        <span class="keyword">let</span> timeRange = instruction.timeRange</span><br><span class="line">        <span class="keyword">let</span> videoWidth = <span class="keyword">self</span>.videoComposition.renderSize.width</span><br><span class="line">        <span class="keyword">if</span> type == <span class="type">TransitionType</span>.<span class="type">Push</span>&#123;</span><br><span class="line">            <span class="keyword">let</span> fromEndTranform = <span class="type">CGAffineTransform</span>(translationX: -videoWidth, y: <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">let</span> toStartTranform = <span class="type">CGAffineTransform</span>(translationX: videoWidth, y: <span class="number">0</span>)</span><br><span class="line">            </span><br><span class="line">            fromLayer.setTransformRamp(fromStart: identityTransform, toEnd: fromEndTranform, timeRange: timeRange)</span><br><span class="line">            toLayer.setTransformRamp(fromStart: toStartTranform, toEnd: identityTransform, timeRange: timeRange)</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            fromLayer.setOpacityRamp(fromStartOpacity: <span class="number">1.0</span>, toEndOpacity: <span class="number">0.0</span>, timeRange: timeRange)</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//重新赋值</span></span><br><span class="line">        instruction.layerInstructions = [fromLayer,toLayer]</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h5 id="Demo"><a href="#Demo" class="headerlink" title="Demo"></a>Demo</h5><p><a href="https://github.com/jackfrow/AVFoundationDemo" target="_blank" rel="noopener">AVFoundationDemo</a></p>
<h4 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h4><ul>
<li><a href="http://zichao.me/2016/03/28/视频开发总结/" target="_blank" rel="noopener">AVFoundation视屏开发总结</a></li>
<li><a href="https://juejin.im/post/5bee688ae51d45313b1ac683" target="_blank" rel="noopener">LearningAVFoundation之视频合成+转场过渡动画</a></li>
<li><a href="https://objccn.io/issue-23-1/" target="_blank" rel="noopener"><strong>在 iOS 上捕获视频</strong></a></li>
<li><a href="https://www.raywenderlich.com/5135-how-to-play-record-and-merge-videos-in-ios-and-swift" target="_blank" rel="noopener">How to Play, Record, and Merge Videos in iOS and Swift</a></li>
<li><a href="https://www.raywenderlich.com/2734-avfoundation-tutorial-adding-overlays-and-animations-to-videos" target="_blank" rel="noopener">AVFoundation Tutorial: Adding Overlays and Animations to Videos</a></li>
<li><a href="https://developer.apple.com/library/archive/documentation/AudioVideo/Conceptual/AVFoundationPG/Articles/00_Introduction.html#//apple_ref/doc/uid/TP40010188" target="_blank" rel="noopener">AVFoundation Programming Guide</a></li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/08/30/TPKeyboardAvoiding源码解析/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="jackfrow">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/08/30/TPKeyboardAvoiding源码解析/" itemprop="url">TPKeyboardAvoiding源码解析</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-08-30T16:35:40+08:00">
                2019-08-30
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/源码阅读/" itemprop="url" rel="index">
                    <span itemprop="name">源码阅读</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="简介-TPKeyboardAvoiding是一个第三方键盘管理工具，作用是避免键盘遮挡视图。"><a href="#简介-TPKeyboardAvoiding是一个第三方键盘管理工具，作用是避免键盘遮挡视图。" class="headerlink" title="简介 : TPKeyboardAvoiding是一个第三方键盘管理工具，作用是避免键盘遮挡视图。"></a>简介 : TPKeyboardAvoiding是一个第三方键盘管理工具，作用是避免键盘遮挡视图。</h4><h4 id="框架结构"><a href="#框架结构" class="headerlink" title="框架结构 "></a>框架结构 <img src="https://tva1.sinaimg.cn/large/006y8mN6gy1g6kxpmgzg6j30jp082aal.jpg" alt="TPKeyboardAvoiding"></h4><p>其中一共有3个类,1个分类。</p>
<h4 id="框架使用"><a href="#框架使用" class="headerlink" title="框架使用"></a>框架使用</h4><p><img src="https://tva1.sinaimg.cn/large/006y8mN6gy1g6kxq56c6tj31eo08edh7.jpg" alt="image-20190830170555434"></p>
<p>只需要将用到tableView的地方替换成TPKeyboardAvoidingTableView，同理适用于TPKeyboardAvoidingCollectionView，TPKeyboardAvoidingScrollView。其中整个核心都是利用UIScrollView (TPKeyboardAvoidingAdditions)来实现的。</p>
<h4 id="源码解析"><a href="#源码解析" class="headerlink" title="源码解析"></a>源码解析</h4><p>由于整个核心实现都是在以下代码中实现的，所以主要针对以下两个方法进行讲解。</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)TPKeyboardAvoiding_keyboardWillShow:(<span class="built_in">NSNotification</span>*)notification;</span><br><span class="line">- (<span class="keyword">void</span>)TPKeyboardAvoiding_keyboardWillHide:(<span class="built_in">NSNotification</span>*)notification;</span><br></pre></td></tr></table></figure>

<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)TPKeyboardAvoiding_keyboardWillShow:(<span class="built_in">NSNotification</span>*)notification &#123;</span><br><span class="line">    <span class="built_in">NSDictionary</span> *info = [notification userInfo];</span><br><span class="line">    TPKeyboardAvoidingState *state = <span class="keyword">self</span>.keyboardAvoidingState;</span><br><span class="line">    </span><br><span class="line">    state.animationDuration = [[info objectForKey:kUIKeyboardAnimationDurationUserInfoKey] doubleValue];</span><br><span class="line"></span><br><span class="line">    <span class="built_in">CGRect</span> keyboardRect = [<span class="keyword">self</span> convertRect:[[info objectForKey:_UIKeyboardFrameEndUserInfoKey] <span class="built_in">CGRectValue</span>] fromView:<span class="literal">nil</span>];</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">CGRectIsEmpty</span>(keyboardRect)) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> ( state.ignoringNotifications ) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    state.keyboardRect = keyboardRect;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ( !state.keyboardVisible ) &#123;</span><br><span class="line">        state.priorInset = <span class="keyword">self</span>.contentInset;</span><br><span class="line">        state.priorScrollIndicatorInsets = <span class="keyword">self</span>.scrollIndicatorInsets;</span><br><span class="line">        state.priorPagingEnabled = <span class="keyword">self</span>.pagingEnabled;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    state.keyboardVisible = <span class="literal">YES</span>;</span><br><span class="line">    <span class="keyword">self</span>.pagingEnabled = <span class="literal">NO</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ( [<span class="keyword">self</span> isKindOfClass:[TPKeyboardAvoidingScrollView <span class="keyword">class</span>]] ) &#123;</span><br><span class="line">        state.priorContentSize = <span class="keyword">self</span>.contentSize;</span><br><span class="line">        <span class="keyword">self</span>.contentSize = <span class="built_in">CGSizeZero</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> ( <span class="built_in">CGSizeEqualToSize</span>(<span class="keyword">self</span>.contentSize, <span class="built_in">CGSizeZero</span>) ) &#123;</span><br><span class="line">            <span class="comment">// Set the content size, if it's not set. Do not set content size explicitly if auto-layout</span></span><br><span class="line">            <span class="comment">// is being used to manage subviews</span></span><br><span class="line">            <span class="keyword">self</span>.contentSize = [<span class="keyword">self</span> TPKeyboardAvoiding_calculatedContentSizeFromSubviewFrames];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Delay until a future run loop such that the cursor position is available in a text view</span></span><br><span class="line">    <span class="comment">// In other words, it's not available (specifically, the prior cursor position is returned) when the first keyboard position change notification fires</span></span><br><span class="line">    <span class="comment">// <span class="doctag">NOTE:</span> Unfortunately, using dispatch_async(main_queue) did not result in a sufficient-enough delay</span></span><br><span class="line">    <span class="comment">// for the text view's current cursor position to be available</span></span><br><span class="line">    dispatch_time_t delay = dispatch_time(DISPATCH_TIME_NOW, (int64_t)(<span class="number">0.01</span> * <span class="built_in">NSEC_PER_SEC</span>));</span><br><span class="line">    </span><br><span class="line">    dispatch_after(delay, dispatch_get_main_queue(), ^&#123;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Shrink view's inset by the keyboard's height, and scroll to show the text field/view being edited</span></span><br><span class="line">        [<span class="built_in">UIView</span> beginAnimations:<span class="literal">nil</span> context:<span class="literal">NULL</span>];</span><br><span class="line">        </span><br><span class="line">        [<span class="built_in">UIView</span> setAnimationDelegate:<span class="keyword">self</span>];</span><br><span class="line">        [<span class="built_in">UIView</span> setAnimationWillStartSelector:<span class="keyword">@selector</span>(keyboardViewAppear:context:)];</span><br><span class="line">        </span><br><span class="line">        [<span class="built_in">UIView</span> setAnimationDidStopSelector:<span class="keyword">@selector</span>(keyboardViewDisappear:finished:context:)];</span><br><span class="line">        </span><br><span class="line">        [<span class="built_in">UIView</span> setAnimationCurve:[[[notification userInfo] objectForKey:<span class="built_in">UIKeyboardAnimationCurveUserInfoKey</span>] intValue]];</span><br><span class="line">        [<span class="built_in">UIView</span> setAnimationDuration:[[[notification userInfo] objectForKey:<span class="built_in">UIKeyboardAnimationDurationUserInfoKey</span>] floatValue]];</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">self</span>.contentInset = [<span class="keyword">self</span> TPKeyboardAvoiding_contentInsetForKeyboard];</span><br><span class="line">        </span><br><span class="line">        <span class="built_in">UIView</span> *firstResponder = [<span class="keyword">self</span> TPKeyboardAvoiding_findFirstResponderBeneathView:<span class="keyword">self</span>];</span><br><span class="line">        <span class="keyword">if</span> ( firstResponder ) &#123;</span><br><span class="line">            <span class="built_in">CGFloat</span> viewableHeight = <span class="keyword">self</span>.bounds.size.height - <span class="keyword">self</span>.contentInset.top - <span class="keyword">self</span>.contentInset.bottom;</span><br><span class="line">            [<span class="keyword">self</span> setContentOffset:<span class="built_in">CGPointMake</span>(<span class="keyword">self</span>.contentOffset.x,</span><br><span class="line">                                               [<span class="keyword">self</span> TPKeyboardAvoiding_idealOffsetForView:firstResponder</span><br><span class="line">                                                                     withViewingAreaHeight:viewableHeight])</span><br><span class="line">                          animated:<span class="literal">NO</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">self</span>.scrollIndicatorInsets = <span class="keyword">self</span>.contentInset;</span><br><span class="line">        [<span class="keyword">self</span> layoutIfNeeded];</span><br><span class="line">        </span><br><span class="line">        [<span class="built_in">UIView</span> commitAnimations];</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>该方法主要分为以下几个步骤:</p>
<p>1、拿到键盘将要出现的状态；</p>
<p>2、保存当前ScrollView的状态；</p>
<p>3、计算当前ScrollView滚动范围；</p>
<p>4、调整ScrollView的contentInset；</p>
<p>5、调整ScrollView的ContentOffset。</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)TPKeyboardAvoiding_keyboardWillHide:(<span class="built_in">NSNotification</span>*)notification &#123;</span><br><span class="line">    <span class="built_in">CGRect</span> keyboardRect = [<span class="keyword">self</span> convertRect:[[[notification userInfo] objectForKey:_UIKeyboardFrameEndUserInfoKey] <span class="built_in">CGRectValue</span>] fromView:<span class="literal">nil</span>];</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">CGRectIsEmpty</span>(keyboardRect) &amp;&amp; !<span class="keyword">self</span>.keyboardAvoidingState.keyboardAnimationInProgress) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    TPKeyboardAvoidingState *state = <span class="keyword">self</span>.keyboardAvoidingState;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> ( state.ignoringNotifications ) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> ( !state.keyboardVisible ) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    state.keyboardRect = <span class="built_in">CGRectZero</span>;</span><br><span class="line">    state.keyboardVisible = <span class="literal">NO</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Restore dimensions to prior size</span></span><br><span class="line">    [<span class="built_in">UIView</span> beginAnimations:<span class="literal">nil</span> context:<span class="literal">NULL</span>];</span><br><span class="line">    [<span class="built_in">UIView</span> setAnimationCurve:[[[notification userInfo] objectForKey:<span class="built_in">UIKeyboardAnimationCurveUserInfoKey</span>] intValue]];</span><br><span class="line">    [<span class="built_in">UIView</span> setAnimationDuration:[[[notification userInfo] objectForKey:<span class="built_in">UIKeyboardAnimationDurationUserInfoKey</span>] floatValue]];</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> ( [<span class="keyword">self</span> isKindOfClass:[TPKeyboardAvoidingScrollView <span class="keyword">class</span>]] ) &#123;</span><br><span class="line">        <span class="keyword">self</span>.contentSize = state.priorContentSize;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">self</span>.contentInset = state.priorInset;</span><br><span class="line">    <span class="keyword">self</span>.scrollIndicatorInsets = state.priorScrollIndicatorInsets;</span><br><span class="line">    <span class="keyword">self</span>.pagingEnabled = state.priorPagingEnabled;</span><br><span class="line">	[<span class="keyword">self</span> layoutIfNeeded];</span><br><span class="line">    [<span class="built_in">UIView</span> commitAnimations];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>该方法主要负责ScrollView状态的恢复。</p>
<p>至此，该框架的核心方法已经总结完毕。</p>
<h4 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h4><p>TPKeyboardAvoiding主要调整contentInset和contentOffset来解决键盘的遮挡问题。以后如果需要自己设计一个解决键盘遮挡问题的框架，便可以参考此思路。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/08/23/APP冷启动/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="jackfrow">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/08/23/APP冷启动/" itemprop="url">APP冷启动</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-08-23T11:21:40+08:00">
                2019-08-23
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/学习总结/" itemprop="url" rel="index">
                    <span itemprop="name">学习总结</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="什么是APP冷启动"><a href="#什么是APP冷启动" class="headerlink" title="什么是APP冷启动"></a>什么是APP冷启动</h4><p>APP冷启动是指，APP点击启动前，它的进程不在系统里，需要系统新创建一个进程分配给它启动的过程。这是一次完整的启动过程。APP冷启动时间的长短是衡量一个APP好坏的重要标志。</p>
<h4 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h4><p>网上好多文章完全就是乱扯，抄过去抄过来，在didFinishLaunchingWithOptions方法完成之前，你的APP怎么可能完成首屏渲染，吐槽一下。（手机运行会做一定程度的优化，并不会完全等didFinishLaunchingWithOptions执行完再去渲染首屏界面）</p>
<h4 id="APP启动阶段"><a href="#APP启动阶段" class="headerlink" title="APP启动阶段"></a>APP启动阶段</h4><p>APP启动阶段主要分为两个阶段：</p>
<p>1.main()函数执行之前</p>
<p>2.main()函数之后</p>
<h4 id="main函数执行之前"><a href="#main函数执行之前" class="headerlink" title="main函数执行之前"></a>main函数执行之前</h4><p>在main()函数执行之前，系统主要会做下面几件事情：</p>
<ol>
<li>加载可执行文件（APP的.o文件的集合）</li>
<li>加载动态链接库,进行rebase指针调整和bing符号绑定</li>
<li>Objc运行时的初始化处理，包括 Objc 相关类的注册、category 注册、selector唯一性检查等</li>
<li>load()方法初始化</li>
</ol>
<h4 id="优化方案"><a href="#优化方案" class="headerlink" title="优化方案"></a>优化方案</h4><ol>
<li>对多个非系统动态库进行合并（最多支持6个）</li>
<li>减少load()方法中的耗时操作</li>
</ol>
<h4 id="main-函数之后"><a href="#main-函数之后" class="headerlink" title="main()函数之后"></a>main()函数之后</h4><p>main()函数指的是didFinishLaunchingWithOptions方法中执行的操作。</p>
<h4 id="优化方案-1"><a href="#优化方案-1" class="headerlink" title="优化方案"></a>优化方案</h4><ol>
<li>将非首屏渲染必须的操作异步执行。</li>
<li>如果有广告页面，可以考虑将耗时操作放广告页中执行一半(或者全部)，在首屏中再执行剩下的一半。</li>
</ol>
<h4 id="检测手段"><a href="#检测手段" class="headerlink" title="检测手段"></a>检测手段</h4><ol>
<li><p>TimerProfile :使用指导:<a href="https://link.juejin.im/?target=https%3A%2F%2Fwww.raywenderlich.com%2F397-instruments-tutorial-with-swift-getting-started" target="_blank" rel="noopener">Instruments Tutorial with Swift: Getting Started</a></p>
</li>
<li><p>打点测试。</p>
</li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/08/08/iOS中常用 的三方库/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="jackfrow">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/08/08/iOS中常用 的三方库/" itemprop="url">iOS中常用的三方库</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-08-08T15:21:40+08:00">
                2019-08-08
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/学习总结/" itemprop="url" rel="index">
                    <span itemprop="name">学习总结</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Masonry(页面布局 ) –&gt; <a href="https://github.com/SnapKit/Masonry" target="_blank" rel="noopener">Masonry</a></p>
<p>AFNetworking(网络请求)  –&gt; <a href="https://github.com/AFNetworking/AFNetworking" target="_blank" rel="noopener">AFNetworking</a></p>
<p>CocoaLumberjack(记录log) –&gt; <a href="https://github.com/CocoaLumberjack/CocoaLumberjack" target="_blank" rel="noopener">CocoaLumberjack</a></p>
<p>YTKNetwork(网络请求使用层优化) –&gt; <a href="https://github.com/yuantiku/YTKNetwork" target="_blank" rel="noopener">YTKNetwork</a></p>
<p>SAMKeychain(用来存储账号密码) –&gt; <a href="https://github.com/soffes/SAMKeychain" target="_blank" rel="noopener">SAMKeychain</a></p>
<p>SDWebImage(图片加载) –&gt; <a href="https://github.com/SDWebImage/SDWebImage" target="_blank" rel="noopener">SDWebImage</a></p>
<p>MBProgressHUD(进度指示) –&gt; <a href="https://github.com/jdg/MBProgressHUD" target="_blank" rel="noopener">MBProgressHUD</a></p>
<p>IQKeyboardManager(键盘管理) –&gt; <a href="https://github.com/hackiftekhar/IQKeyboardManager" target="_blank" rel="noopener">IQKeyboardManager</a></p>
<p>ReactiveObjC(OC响应式框架) –&gt; <a href="https://github.com/ReactiveCocoa/ReactiveObjC" target="_blank" rel="noopener">ReactiveObjC</a></p>
<p>RJBadgeKit(小红点统一管理工具) –&gt; <a href="https://github.com/RylanJIN/RJBadgeKit" target="_blank" rel="noopener">RJBadgeKit</a></p>
<p>WMPageController(分页控制管理器) –&gt; <a href="https://github.com/wangmchn/WMPageController" target="_blank" rel="noopener">WMPageController</a></p>
<p>YYKit(工具库) –&gt; <a href="https://github.com/ibireme/YYKit" target="_blank" rel="noopener">YYKit</a></p>
<p>IDMPhotoBrowser(图片浏览器) –&gt; <a href="https://github.com/thiagoperes/IDMPhotoBrowser" target="_blank" rel="noopener">IDMPhotoBrowser</a></p>
<p>DZNEmptyDataSet(空数据设置) –&gt; <a href="https://github.com/dzenbot/DZNEmptyDataSet" target="_blank" rel="noopener">DZNEmptyDataSet</a></p>
<p>MLeaksFinder(内存泄露检测) –&gt; <a href="https://github.com/Tencent/MLeaksFinder" target="_blank" rel="noopener">MLeaksFinder</a></p>
<p>Bagel（网络请求打印） –&gt; <a href="https://github.com/yagiz/Bagel" target="_blank" rel="noopener">Bagel</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/05/23/MBProgressHUD源码解析/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="jackfrow">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/05/23/MBProgressHUD源码解析/" itemprop="url">MBProgressHUD源码解析</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-05-23T22:30:00+08:00">
                2019-05-23
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/源码阅读/" itemprop="url" rel="index">
                    <span itemprop="name">源码阅读</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>​    在所有程序员提高的方法中，几乎所有人都提到了要多读优秀的源码。所以在学习的路途中便开始了源码阅读的计划，至于从哪个源码开始呢，首先肯定是要自己经常用的，并且比较优秀的。所以最终确定为从MBProgressHUD开始进行源码计划。</p>
<h3 id="功能"><a href="#功能" class="headerlink" title="功能"></a>功能</h3><blockquote>
<p>MBProgressHUD是一个为iOS添加悬浮层的框架，主要用在网络请求，弹窗提示等场景。</p>
</blockquote>
<h3 id="框架结构"><a href="#框架结构" class="headerlink" title="框架结构"></a>框架结构</h3><blockquote>
<h5 id="MBProgressHUD包含了4个类，MBProgressHUD，MBRoundProgressView，MBBarProgressView，MBBackgroundView"><a href="#MBProgressHUD包含了4个类，MBProgressHUD，MBRoundProgressView，MBBarProgressView，MBBackgroundView" class="headerlink" title="MBProgressHUD包含了4个类，MBProgressHUD，MBRoundProgressView，MBBarProgressView，MBBackgroundView."></a>MBProgressHUD包含了4个类，MBProgressHUD，MBRoundProgressView，MBBarProgressView，MBBackgroundView.</h5></blockquote>
<h3 id="API结构"><a href="#API结构" class="headerlink" title="API结构"></a>API结构</h3><h4 id="MBProgressHUD"><a href="#MBProgressHUD" class="headerlink" title="MBProgressHUD"></a>MBProgressHUD</h4><h5 id="方法"><a href="#方法" class="headerlink" title="方法"></a>方法</h5><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">+ (<span class="keyword">instancetype</span>)showHUDAddedTo:(<span class="built_in">UIView</span> *)view animated:(<span class="built_in">BOOL</span>)animated;</span><br><span class="line">+ (<span class="built_in">BOOL</span>)hideHUDForView:(<span class="built_in">UIView</span> *)view animated:(<span class="built_in">BOOL</span>)animated;</span><br><span class="line">+ (<span class="keyword">nullable</span> MBProgressHUD *)HUDForView:(<span class="built_in">UIView</span> *)view;</span><br><span class="line">- (<span class="keyword">instancetype</span>)initWithView:(<span class="built_in">UIView</span> *)view;</span><br><span class="line">- (<span class="keyword">void</span>)showAnimated:(<span class="built_in">BOOL</span>)animated;</span><br><span class="line">- (<span class="keyword">void</span>)hideAnimated:(<span class="built_in">BOOL</span>)animated;</span><br><span class="line">- (<span class="keyword">void</span>)hideAnimated:(<span class="built_in">BOOL</span>)animated afterDelay:(<span class="built_in">NSTimeInterval</span>)delay;</span><br></pre></td></tr></table></figure>

<h5 id="属性"><a href="#属性" class="headerlink" title="属性"></a><strong>属性</strong></h5><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@property</span> (<span class="keyword">weak</span>, <span class="keyword">nonatomic</span>) <span class="keyword">id</span>&lt;MBProgressHUDDelegate&gt; delegate;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">copy</span>, <span class="keyword">nullable</span>) MBProgressHUDCompletionBlock completionBlock;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">assign</span>, <span class="keyword">nonatomic</span>) <span class="built_in">NSTimeInterval</span> graceTime;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">assign</span>, <span class="keyword">nonatomic</span>) <span class="built_in">NSTimeInterval</span> minShowTime;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">assign</span>, <span class="keyword">nonatomic</span>) <span class="built_in">BOOL</span> removeFromSuperViewOnHide;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">assign</span>, <span class="keyword">nonatomic</span>) MBProgressHUDMode mode;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">strong</span>, <span class="keyword">nonatomic</span>, <span class="keyword">nullable</span>) <span class="built_in">UIColor</span> *contentColor <span class="built_in">UI_APPEARANCE_SELECTOR</span>;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">assign</span>, <span class="keyword">nonatomic</span>) MBProgressHUDAnimation animationType <span class="built_in">UI_APPEARANCE_SELECTOR</span>;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">assign</span>, <span class="keyword">nonatomic</span>) <span class="built_in">CGPoint</span> offset <span class="built_in">UI_APPEARANCE_SELECTOR</span>;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">assign</span>, <span class="keyword">nonatomic</span>) <span class="built_in">CGFloat</span> margin <span class="built_in">UI_APPEARANCE_SELECTOR</span>;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">assign</span>, <span class="keyword">nonatomic</span>) <span class="built_in">CGSize</span> minSize <span class="built_in">UI_APPEARANCE_SELECTOR</span>;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">assign</span>, <span class="keyword">nonatomic</span>, <span class="keyword">getter</span> = isSquare) <span class="built_in">BOOL</span> square <span class="built_in">UI_APPEARANCE_SELECTOR</span>;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">assign</span>, <span class="keyword">nonatomic</span>, <span class="keyword">getter</span>=areDefaultMotionEffectsEnabled) <span class="built_in">BOOL</span> defaultMotionEffectsEnabled <span class="built_in">UI_APPEARANCE_SELECTOR</span>;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">assign</span>, <span class="keyword">nonatomic</span>) <span class="keyword">float</span> progress;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">strong</span>, <span class="keyword">nonatomic</span>, <span class="keyword">nullable</span>) <span class="built_in">NSProgress</span> *progressObject;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">strong</span>, <span class="keyword">nonatomic</span>, <span class="keyword">readonly</span>) MBBackgroundView *bezelView;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">strong</span>, <span class="keyword">nonatomic</span>, <span class="keyword">readonly</span>) MBBackgroundView *backgroundView;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">strong</span>, <span class="keyword">nonatomic</span>, <span class="keyword">nullable</span>) <span class="built_in">UIView</span> *customView;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">strong</span>, <span class="keyword">nonatomic</span>, <span class="keyword">readonly</span>) <span class="built_in">UILabel</span> *label;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">strong</span>, <span class="keyword">nonatomic</span>, <span class="keyword">readonly</span>) <span class="built_in">UILabel</span> *detailsLabel;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">strong</span>, <span class="keyword">nonatomic</span>, <span class="keyword">readonly</span>) <span class="built_in">UIButton</span> *button;</span><br></pre></td></tr></table></figure>

<h4 id="MBRoundProgressView"><a href="#MBRoundProgressView" class="headerlink" title="MBRoundProgressView"></a>MBRoundProgressView</h4><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">assign</span>) <span class="keyword">float</span> progress;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">UIColor</span> *progressTintColor;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">UIColor</span> *backgroundTintColor;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">assign</span>, <span class="keyword">getter</span> = isAnnular) <span class="built_in">BOOL</span> annular;</span><br></pre></td></tr></table></figure>

<h4 id="MBBarProgressView"><a href="#MBBarProgressView" class="headerlink" title="MBBarProgressView"></a>MBBarProgressView</h4><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">assign</span>) <span class="keyword">float</span> progress;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">UIColor</span> *lineColor;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">UIColor</span> *progressRemainingColor;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">UIColor</span> *progressColor;</span><br></pre></td></tr></table></figure>

<h4 id="MBBackgroundView"><a href="#MBBackgroundView" class="headerlink" title="MBBackgroundView"></a>MBBackgroundView</h4><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>) MBProgressHUDBackgroundStyle style;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>) <span class="built_in">UIBlurEffectStyle</span> blurEffectStyle;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">UIColor</span> *color;</span><br></pre></td></tr></table></figure>

<h3 id="调用流程"><a href="#调用流程" class="headerlink" title="调用流程"></a>调用流程</h3><p>外部暴露的API主要分为show和hide两个类，不论是show还是hide，方法的最终调用都会走到<code>animateIn:withType: completion:</code>，下面是方法调用流程图。</p>
<p><img src="http://ww2.sinaimg.cn/large/006tNc79ly1g3g2vm1hh6j314e0irdis.jpg" alt></p>
<h3 id="内部实现"><a href="#内部实现" class="headerlink" title="内部实现"></a>内部实现</h3><h4 id="show"><a href="#show" class="headerlink" title="show"></a>show</h4><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">+ (<span class="keyword">instancetype</span>)showHUDAddedTo:(<span class="built_in">UIView</span> *)view animated:(<span class="built_in">BOOL</span>)animated &#123;</span><br><span class="line">    MBProgressHUD *hud = [[<span class="keyword">self</span> alloc] initWithView:view];</span><br><span class="line">    hud.removeFromSuperViewOnHide = <span class="literal">YES</span>;</span><br><span class="line">    [view addSubview:hud];</span><br><span class="line">    [hud showAnimated:animated];</span><br><span class="line">    <span class="keyword">return</span> hud;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)showAnimated:(<span class="built_in">BOOL</span>)animated &#123;</span><br><span class="line">    MBMainThreadAssert();</span><br><span class="line">    [<span class="keyword">self</span>.minShowTimer invalidate];</span><br><span class="line">    <span class="keyword">self</span>.useAnimation = animated;</span><br><span class="line">    <span class="keyword">self</span>.finished = <span class="literal">NO</span>;</span><br><span class="line">    <span class="comment">// If the grace time is set, postpone the HUD display</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>.graceTime &gt; <span class="number">0.0</span>) &#123;</span><br><span class="line">        <span class="built_in">NSTimer</span> *timer = [<span class="built_in">NSTimer</span> timerWithTimeInterval:<span class="keyword">self</span>.graceTime target:<span class="keyword">self</span> selector:<span class="keyword">@selector</span>(handleGraceTimer:) userInfo:<span class="literal">nil</span> repeats:<span class="literal">NO</span>];</span><br><span class="line">        [[<span class="built_in">NSRunLoop</span> currentRunLoop] addTimer:timer forMode:<span class="built_in">NSRunLoopCommonModes</span>];</span><br><span class="line">        <span class="keyword">self</span>.graceTimer = timer;</span><br><span class="line">    &#125; </span><br><span class="line">    <span class="comment">// ... otherwise show the HUD immediately</span></span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        [<span class="keyword">self</span> showUsingAnimation:<span class="keyword">self</span>.useAnimation];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)showUsingAnimation:(<span class="built_in">BOOL</span>)animated &#123;</span><br><span class="line">    <span class="comment">// Cancel any previous animations</span></span><br><span class="line">    [<span class="keyword">self</span>.bezelView.layer removeAllAnimations];</span><br><span class="line">    [<span class="keyword">self</span>.backgroundView.layer removeAllAnimations];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Cancel any scheduled hideAnimated:afterDelay: calls</span></span><br><span class="line">    [<span class="keyword">self</span>.hideDelayTimer invalidate];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">self</span>.showStarted = [<span class="built_in">NSDate</span> date];</span><br><span class="line">    <span class="keyword">self</span>.alpha = <span class="number">1.</span>f;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Needed in case we hide and re-show with the same NSProgress object attached.</span></span><br><span class="line">    [<span class="keyword">self</span> setNSProgressDisplayLinkEnabled:<span class="literal">YES</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (animated) &#123;</span><br><span class="line">        [<span class="keyword">self</span> animateIn:<span class="literal">YES</span> withType:<span class="keyword">self</span>.animationType completion:<span class="literal">NULL</span>];</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">self</span>.bezelView.alpha = <span class="number">1.</span>f;</span><br><span class="line">        <span class="keyword">self</span>.backgroundView.alpha = <span class="number">1.</span>f;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="hide"><a href="#hide" class="headerlink" title="hide"></a>hide</h4><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">+ (<span class="built_in">BOOL</span>)hideHUDForView:(<span class="built_in">UIView</span> *)view animated:(<span class="built_in">BOOL</span>)animated &#123;</span><br><span class="line">    MBProgressHUD *hud = [<span class="keyword">self</span> HUDForView:view];</span><br><span class="line">    <span class="keyword">if</span> (hud != <span class="literal">nil</span>) &#123;</span><br><span class="line">        hud.removeFromSuperViewOnHide = <span class="literal">YES</span>;</span><br><span class="line">        [hud hideAnimated:animated];</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">YES</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">NO</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">+ (MBProgressHUD *)HUDForView:(<span class="built_in">UIView</span> *)view &#123;</span><br><span class="line">    <span class="built_in">NSEnumerator</span> *subviewsEnum = [view.subviews reverseObjectEnumerator];</span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">UIView</span> *subview <span class="keyword">in</span> subviewsEnum) &#123;</span><br><span class="line">        <span class="keyword">if</span> ([subview isKindOfClass:<span class="keyword">self</span>]) &#123;</span><br><span class="line">            MBProgressHUD *hud = (MBProgressHUD *)subview;</span><br><span class="line">            <span class="keyword">if</span> (hud.hasFinished == <span class="literal">NO</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> hud;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"> (<span class="keyword">void</span>)hideAnimated:(<span class="built_in">BOOL</span>)animated &#123;</span><br><span class="line">    MBMainThreadAssert();</span><br><span class="line">    [<span class="keyword">self</span>.graceTimer invalidate];</span><br><span class="line">    <span class="keyword">self</span>.useAnimation = animated;</span><br><span class="line">    <span class="keyword">self</span>.finished = <span class="literal">YES</span>;</span><br><span class="line">    <span class="comment">// If the minShow time is set, calculate how long the HUD was shown,</span></span><br><span class="line">    <span class="comment">// and postpone the hiding operation if necessary</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>.minShowTime &gt; <span class="number">0.0</span> &amp;&amp; <span class="keyword">self</span>.showStarted) &#123;</span><br><span class="line">        <span class="built_in">NSTimeInterval</span> interv = [[<span class="built_in">NSDate</span> date] timeIntervalSinceDate:<span class="keyword">self</span>.showStarted];</span><br><span class="line">        <span class="keyword">if</span> (interv &lt; <span class="keyword">self</span>.minShowTime) &#123;</span><br><span class="line">            <span class="built_in">NSTimer</span> *timer = [<span class="built_in">NSTimer</span> timerWithTimeInterval:(<span class="keyword">self</span>.minShowTime - interv) target:<span class="keyword">self</span> selector:<span class="keyword">@selector</span>(handleMinShowTimer:) userInfo:<span class="literal">nil</span> repeats:<span class="literal">NO</span>];</span><br><span class="line">            [[<span class="built_in">NSRunLoop</span> currentRunLoop] addTimer:timer forMode:<span class="built_in">NSRunLoopCommonModes</span>];</span><br><span class="line">            <span class="keyword">self</span>.minShowTimer = timer;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125; </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ... otherwise hide the HUD immediately</span></span><br><span class="line">    [<span class="keyword">self</span> hideUsingAnimation:<span class="keyword">self</span>.useAnimation];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)hideUsingAnimation:(<span class="built_in">BOOL</span>)animated &#123;</span><br><span class="line">    <span class="comment">// Cancel any scheduled hideAnimated:afterDelay: calls.</span></span><br><span class="line">    <span class="comment">// This needs to happen here instead of in done,</span></span><br><span class="line">    <span class="comment">// to avoid races if another hideAnimated:afterDelay:</span></span><br><span class="line">    <span class="comment">// call comes in while the HUD is animating out.</span></span><br><span class="line">    [<span class="keyword">self</span>.hideDelayTimer invalidate];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (animated &amp;&amp; <span class="keyword">self</span>.showStarted) &#123;</span><br><span class="line">        <span class="keyword">self</span>.showStarted = <span class="literal">nil</span>;</span><br><span class="line">        [<span class="keyword">self</span> animateIn:<span class="literal">NO</span> withType:<span class="keyword">self</span>.animationType completion:^(<span class="built_in">BOOL</span> finished) &#123;</span><br><span class="line">            [<span class="keyword">self</span> done];</span><br><span class="line">        &#125;];</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">self</span>.showStarted = <span class="literal">nil</span>;</span><br><span class="line">        <span class="keyword">self</span>.bezelView.alpha = <span class="number">0.</span>f;</span><br><span class="line">        <span class="keyword">self</span>.backgroundView.alpha = <span class="number">1.</span>f;</span><br><span class="line">        [<span class="keyword">self</span> done];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里注意一下在拿当前hud时的方法.</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">+ (MBProgressHUD *)HUDForView:(<span class="built_in">UIView</span> *)view &#123;</span><br><span class="line">    <span class="built_in">NSEnumerator</span> *subviewsEnum = [view.subviews reverseObjectEnumerator];</span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">UIView</span> *subview <span class="keyword">in</span> subviewsEnum) &#123;</span><br><span class="line">        <span class="keyword">if</span> ([subview isKindOfClass:<span class="keyword">self</span>]) &#123;</span><br><span class="line">            MBProgressHUD *hud = (MBProgressHUD *)subview;</span><br><span class="line">            <span class="keyword">if</span> (hud.hasFinished == <span class="literal">NO</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> hud;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>因为hud通常是最后放上去的，所以这里在拿hud的时候使用反向枚举器，可以减少循环次数。</p>
<p>而无论是<code>show</code>方法，还是<code>hide</code>方法，在设定animated属性为YES的前提下，最终都会走到<code>animateIn: withType: completion:</code>方法：</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)animateIn:(<span class="built_in">BOOL</span>)animatingIn withType:(MBProgressHUDAnimation)type completion:(<span class="keyword">void</span>(^)(<span class="built_in">BOOL</span> finished))completion &#123;</span><br><span class="line">    <span class="comment">// Automatically determine the correct zoom animation type</span></span><br><span class="line">    <span class="keyword">if</span> (type == MBProgressHUDAnimationZoom) &#123;</span><br><span class="line">        type = animatingIn ? MBProgressHUDAnimationZoomIn : MBProgressHUDAnimationZoomOut;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">CGAffineTransform</span> small = <span class="built_in">CGAffineTransformMakeScale</span>(<span class="number">0.5</span>f, <span class="number">0.5</span>f);</span><br><span class="line">    <span class="built_in">CGAffineTransform</span> large = <span class="built_in">CGAffineTransformMakeScale</span>(<span class="number">1.5</span>f, <span class="number">1.5</span>f);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Set starting state</span></span><br><span class="line">    <span class="built_in">UIView</span> *bezelView = <span class="keyword">self</span>.bezelView;</span><br><span class="line">    <span class="keyword">if</span> (animatingIn &amp;&amp; bezelView.alpha == <span class="number">0.</span>f &amp;&amp; type == MBProgressHUDAnimationZoomIn) &#123;</span><br><span class="line">        bezelView.transform = small;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (animatingIn &amp;&amp; bezelView.alpha == <span class="number">0.</span>f &amp;&amp; type == MBProgressHUDAnimationZoomOut) &#123;</span><br><span class="line">        bezelView.transform = large;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Perform animations</span></span><br><span class="line">    dispatch_block_t animations = ^&#123;</span><br><span class="line">        <span class="keyword">if</span> (animatingIn) &#123;</span><br><span class="line">            bezelView.transform = <span class="built_in">CGAffineTransformIdentity</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (!animatingIn &amp;&amp; type == MBProgressHUDAnimationZoomIn) &#123;</span><br><span class="line">            bezelView.transform = large;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (!animatingIn &amp;&amp; type == MBProgressHUDAnimationZoomOut) &#123;</span><br><span class="line">            bezelView.transform = small;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">CGFloat</span> alpha = animatingIn ? <span class="number">1.</span>f : <span class="number">0.</span>f;</span><br><span class="line">        bezelView.alpha = alpha;</span><br><span class="line">        <span class="keyword">self</span>.backgroundView.alpha = alpha;</span><br><span class="line">    &#125;;</span><br><span class="line">    [<span class="built_in">UIView</span> animateWithDuration:<span class="number">0.3</span> delay:<span class="number">0.</span> usingSpringWithDamping:<span class="number">1.</span>f initialSpringVelocity:<span class="number">0.</span>f options:<span class="built_in">UIViewAnimationOptionBeginFromCurrentState</span> animations:animations completion:completion];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="收获"><a href="#收获" class="headerlink" title="收获"></a>收获</h3><ol>
<li>暴露出来的API最终都会走到同一个私有方法里。</li>
<li>使用CADisplayLink来刷新更新频率可能很高的view。</li>
<li>使用循环时，注意条件可以减少循环次数，进而对程序进行优化。</li>
<li>在添加hud时可以增加最小时间和延迟执行时间，避免一闪而过。</li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/01/15/iOS生成.pem推送证书/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="jackfrow">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/01/15/iOS生成.pem推送证书/" itemprop="url">iOS pem 证书生成</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-01-15T16:52:59+08:00">
                2019-01-15
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/学习笔记/" itemprop="url" rel="index">
                    <span itemprop="name">学习笔记</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="pem文件概述"><a href="#pem文件概述" class="headerlink" title="pem文件概述"></a>pem文件概述</h1><p>​    pem文件是服务器向苹果服务器做推送时候需要的文件，主要是给php向苹果服务器验证时使用，下面介绍一下pem文件的生成。</p>
<h1 id="生成-pem的方法"><a href="#生成-pem的方法" class="headerlink" title="生成.pem的方法"></a>生成.pem的方法</h1><p>​    生成pem主要有两种方式,1种是分别生成.pem的cert和生成.pem的key,然后再合成服务器需要的.pem。另一种是直接生成服务器需要的.pem。</p>
<h2 id="分别生成"><a href="#分别生成" class="headerlink" title="分别生成"></a>分别生成</h2><h3 id="生成cert文件"><a href="#生成cert文件" class="headerlink" title="生成cert文件"></a>生成cert文件</h3><p><img src="https://i.loli.net/2019/01/16/5c3ea96bedbdb.png" alt="F9EE8275-559C-496A-8B9D-57E6C0DD2308.png"></p>
<p><img src="https://i.loli.net/2019/01/16/5c3ea96b7ee4a.png" alt="C4B31488-5045-44C0-AE65-532E13E210B5.png"></p>
<p><img src="https://i.loli.net/2019/01/16/5c3ea96a5cf94.png" alt="8CADA519-4E76-4242-A40F-58A6FF9BA487.png"></p>
<h3 id="生成key文件"><a href="#生成key文件" class="headerlink" title="生成key文件"></a>生成key文件</h3><p><img src="https://i.loli.net/2019/01/16/5c3ea96bd197e.png" alt="3185DA78-5055-40AA-A8AD-6A2487AEAC7F.png"></p>
<p><img src="https://i.loli.net/2019/01/16/5c3ea96a4926e.png" alt="5CCCADF1-8D36-455B-A5E8-F1D9E6385AB6.png"></p>
<p><img src="https://i.loli.net/2019/01/16/5c3ea96a30943.png" alt="1C5B5045-8DC1-4A7F-A822-B8A76549A535.png"></p>
<h3 id="生成cert-pem文件​"><a href="#生成cert-pem文件​" class="headerlink" title="生成cert pem文件​"></a>生成cert pem文件​</h3><p>​    将apns-dev-cert.p12文件转换为pem格式</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl pkcs12 -clcerts -nokeys -out apns-dev-cert.pem -in apns-dev-cert.p12</span><br></pre></td></tr></table></figure>

<h3 id="生成key-pem文件"><a href="#生成key-pem文件" class="headerlink" title="生成key pem文件"></a>生成key pem文件</h3><p>​    将apns-dev-key.p12文件转换为pem格式</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl pkcs12 -nocerts -out apns-dev-key.pem -in apns-dev-key.p12</span><br></pre></td></tr></table></figure>

<p>​    移除key pem的密码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl rsa -in apns-dev-key.pem -out apns-dev-key.pem</span><br></pre></td></tr></table></figure>

<h3 id="合成推送需要的pem文件"><a href="#合成推送需要的pem文件" class="headerlink" title="合成推送需要的pem文件"></a>合成推送需要的pem文件</h3><p>​    将apns-dev-cert.pem和apns-dev-key.pem文件合成为apns-dev.pem文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat apns-dev-cert.pem apns-dev-key.pem &gt; apns-dev.pem</span><br></pre></td></tr></table></figure>

<h3 id="测试pem文"><a href="#测试pem文" class="headerlink" title="测试pem文"></a>测试pem文</h3><p>在终端测试：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl s_client -connect gateway.sandbox.push.apple.com:2195 -cert apns-dev-cert.pem -key apns-dev-key.pem</span><br></pre></td></tr></table></figure>

<p>终端最后显示以下内容，表示配置pem文件成功，</p>
<p>Key-Arg   : None</p>
<p>Start Time: 1467854873</p>
<p>Timeout   : 300 (sec)</p>
<p>Verify return code: 0 (ok)</p>
<h2 id="直接生成"><a href="#直接生成" class="headerlink" title="直接生成"></a>直接生成</h2><p>​    <strong>同时</strong>选中cert和key,导出一份p12文件。</p>
<p><img src="https://i.loli.net/2019/01/16/5c3ea96ed3b56.png" alt="QQ20190116-102210@2x.png"></p>
<p>​    将p12文件转化成后台需要的pem证书.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl pkcs12 -in push_hilife.p12 -out pushcert.pem -nodes -clcerts</span><br></pre></td></tr></table></figure>

<h3 id="工具"><a href="#工具" class="headerlink" title="工具"></a>工具</h3><p>​    平时涉及到推送都不太好测试，这时候怎么办呢，有网友给出了解决方案，使用它们开发好的工具可以调试推送。</p>
<p><a href="https://github.com/KnuffApp/Knuff" target="_blank" rel="noopener"><em>Knuff</em></a></p>
<p><a href="https://github.com/shaojiankui/SmartPush" target="_blank" rel="noopener"><em>SmartPush</em></a></p>
<h2 id="参考文章"><a href="#参考文章" class="headerlink" title="参考文章"></a>参考文章</h2><p><a href="https://www.jianshu.com/p/cc952ea07a08" target="_blank" rel="noopener">iOS推送证书生成pem文件（详细生成过程）</a></p>
<p><a href="https://stackoverflow.com/questions/21250510/generate-pem-file-used-to-setup-apple-push-notification" target="_blank" rel="noopener">Generate .pem file Used to setup Apple Push Notification</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/12/29/年度总结/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="jackfrow">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/12/29/年度总结/" itemprop="url">2018年度总结</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-12-29T16:52:59+08:00">
                2018-12-29
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/学习笔记/" itemprop="url" rel="index">
                    <span itemprop="name">学习笔记</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>​    <img src="https://user-gold-cdn.xitu.io/2018/12/2/1676f0af490ee858?w=1080&h=658&f=jpeg&s=70619" alt="图片"></p>
<p>​    前言:看到自己关注的开发者大都写了自己的年终终结，仿佛写了总结之后会有一种魔力来督促自己前进似的，所以有了这篇文章。</p>
<p>​    本片文章主要分为三个部分:</p>
<p>​    1.今年的收获。</p>
<p>​    2.今年的遗憾。</p>
<p>​    3.明年的计划。</p>
<h1 id="今年的收获"><a href="#今年的收获" class="headerlink" title="今年的收获"></a>今年的收获</h1><h2 id="思想上的收获"><a href="#思想上的收获" class="headerlink" title="思想上的收获"></a>思想上的收获</h2><ul>
<li>今年最大的收获就是思想上的，以前总有一点抗拒新东西，遇到问题就想去咨询一下圈内大佬，直到有一次问了桌大一个问题.桌大不仅给我解决方案，还附加了一段文字(遇到这种问题应该先去通过搜索解决。因为这样你更可能得到全面的答案。也锻炼了自己的信息筛选能力)。真的是一段醍醐灌顶的话。</li>
</ul>
<h2 id="生活娱乐上的收获"><a href="#生活娱乐上的收获" class="headerlink" title="生活娱乐上的收获"></a>生活娱乐上的收获</h2><ul>
<li>王者荣耀上了王者(准确的说是25星)</li>
</ul>
<h2 id="工作上的收获"><a href="#工作上的收获" class="headerlink" title="工作上的收获"></a>工作上的收获</h2><ul>
<li>读完了一个技术类书籍《编写高质量iOS与OS X代码的52个有效方法》</li>
</ul>
<h1 id="今年的遗憾"><a href="#今年的遗憾" class="headerlink" title="今年的遗憾"></a>今年的遗憾</h1><h2 id="工作"><a href="#工作" class="headerlink" title="工作"></a>工作</h2><ul>
<li>今年有计划一次跳槽，是一家比较大的公司，因为积累不足，导致面试未通过。</li>
</ul>
<h2 id="生活"><a href="#生活" class="headerlink" title="生活"></a>生活</h2><ol>
<li>本来王者荣耀是计划要上一个荣耀王者的，结果到后面发现演员比较多，就放弃了。</li>
<li>由于健身缺少计划，也没能坚持下去。</li>
</ol>
<h1 id="明年的计划"><a href="#明年的计划" class="headerlink" title="明年的计划"></a>明年的计划</h1><p>写这篇文章主要就是为了有一个计划表，所以明年计划会比较多，希望能大致完成。</p>
<h2 id="生活-1"><a href="#生活-1" class="headerlink" title="生活"></a>生活</h2><p><img src="https://user-gold-cdn.xitu.io/2018/12/23/167db9542765516b?imageView2/0/w/1280/h/960/ignore-error/1" alt="健身"></p>
<ul>
<li>明年的好好运动健身了，毕竟动不动就有什么程序员猝死的消息（真的是太可怕了）。明年计划增重10斤肌肉</li>
<li>王者荣耀真的是个很毒的游戏，明年的少打了，娱乐娱乐就行。</li>
</ul>
<h2 id="工作-1"><a href="#工作-1" class="headerlink" title="工作"></a>工作</h2><p><img src="https://user-gold-cdn.xitu.io/2018/12/23/167db9542734ef49?imageView2/0/w/1280/h/960/ignore-error/1" alt="读书"></p>
<h3 id="技术类书籍-4本"><a href="#技术类书籍-4本" class="headerlink" title="技术类书籍(4本+)"></a>技术类书籍(4本+)</h3><ul>
<li>iOS面试之道（已完成）</li>
<li>Objective-C高级编程</li>
<li>测试驱动的iOS开发</li>
<li>图解HTTP</li>
</ul>
<h3 id="非技术类书籍-3本"><a href="#非技术类书籍-3本" class="headerlink" title="非技术类书籍(3本+)"></a>非技术类书籍(3本+)</h3><ul>
<li>人类简史（已完成）</li>
<li>未来简史</li>
<li>微习惯（已完成）</li>
<li>三体</li>
<li>今日简史</li>
</ul>
<h3 id="源码阅读"><a href="#源码阅读" class="headerlink" title="源码阅读"></a>源码阅读</h3><ul>
<li>MBPogressHUD（已完成）</li>
<li>MJRefresh</li>
<li>Toast（已完成）</li>
<li>DZNEmptyDataSet（已完成）</li>
<li>SDWebImage</li>
<li>IDMPhotoBrowser</li>
<li>YYKit</li>
</ul>
<h3 id="跨平台框架"><a href="#跨平台框架" class="headerlink" title="跨平台框架"></a>跨平台框架</h3><ul>
<li>尝试一下ReactNative.</li>
</ul>
<h3 id="学习基金"><a href="#学习基金" class="headerlink" title="学习基金"></a>学习基金</h3><ul>
<li>成立1000元学习基金，一年下来能用到正途上（已购买李明杰底层原理，李明杰swift，戴明的iOS课程）</li>
</ul>
<h3 id="Github"><a href="#Github" class="headerlink" title="Github"></a>Github</h3><ul>
<li>计划发布一个域名管理的开源库(JKIPManager)，这个看起来暂时没什么用</li>
</ul>
<h3 id="博客-6篇"><a href="#博客-6篇" class="headerlink" title="博客(6篇+)"></a>博客(6篇+)</h3><ul>
<li>每两个月写一篇博客来总结自己</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/04/09/cocoapods/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="jackfrow">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/04/09/cocoapods/" itemprop="url">2018 最新安装cocoapods.</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-04-09T22:46:49+08:00">
                2018-04-09
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/学习笔记/" itemprop="url" rel="index">
                    <span itemprop="name">学习笔记</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>事件起因：制作了一个cocoapods库，已经发布成功，但是搜索不出来.删除索引文件并且重新生成也没有用，主要问题就是repos仓库的内容无法更新.</p>
</blockquote>
<h1 id="一、简介"><a href="#一、简介" class="headerlink" title="一、简介"></a>一、简介</h1><h1 id="什么是CocoaPods"><a href="#什么是CocoaPods" class="headerlink" title="什么是CocoaPods"></a>什么是CocoaPods</h1><p>CocoaPods是OS X和iOS下的一个第三类库管理工具，通过CocoaPods工具我们可以为项目添加被称为“Pods”的依赖库（这些类库必须是CocoaPods本身所支持的），并且可以轻松管理其版本。</p>
<p>CocoaPods的好处</p>
<p>1、在引入第三方库时它可以自动为我们完成各种各样的配置，包括配置编译阶段、连接器选项、甚至是ARC环境下的-fno-objc-arc配置等。</p>
<p>2、使用CocoaPods可以很方便地查找新的第三方库，这些类库是比较“标准的”，而不是网上随便找到的，这样可以让我们找到真正好用的类库。</p>
<h1 id="二、Cocoapods安装步骤"><a href="#二、Cocoapods安装步骤" class="headerlink" title="二、Cocoapods安装步骤"></a>二、Cocoapods安装步骤</h1><h2 id="1、升级Ruby环境"><a href="#1、升级Ruby环境" class="headerlink" title="1、升级Ruby环境"></a>1、升级Ruby环境</h2><blockquote>
<p>终端输入：$ gem update –system</p>
</blockquote>
<p>若提示没有权限，</p>
<blockquote>
<p>这时应该输入：$ sudo gem update –system</p>
</blockquote>
<h2 id="2、更换Ruby镜像"><a href="#2、更换Ruby镜像" class="headerlink" title="2、更换Ruby镜像"></a>2、更换Ruby镜像</h2><p>首先移除现有的Ruby镜像</p>
<blockquote>
<p>终端输入：$ gem sources –remove<a href="https://rubygems.org/" target="_blank" rel="noopener">https://rubygems.org/</a></p>
</blockquote>
<p>然后添加国内最新镜像源（淘宝的Ruby镜像已经不更新了）</p>
<blockquote>
<p>终端输入：$ gem sources -a<a href="https://gems.ruby-china.org/" target="_blank" rel="noopener">https://gems.ruby-china.org/</a></p>
</blockquote>
<p>执行完毕之后输入gem sources -l来查看当前镜像</p>
<blockquote>
<p>终端输入：$ gem sources -l</p>
</blockquote>
<p>如果结果是</p>
<p><strong>* CURRENT SOURCES *</strong></p>
<p><a href="https://gems.ruby-china.org/" target="_blank" rel="noopener">https://gems.ruby-china.org/</a></p>
<p>说明添加成功，否则继续执行$ gem source -a  <a href="https://gems.ruby-china.org/来添加" target="_blank" rel="noopener">https://gems.ruby-china.org/来添加</a></p>
<h2 id="3、安装CocoaPods"><a href="#3、安装CocoaPods" class="headerlink" title="3、安装CocoaPods"></a>3、安装CocoaPods</h2><p>接下来开始安装</p>
<blockquote>
<p>终端输入：$ sudo gem install cocoapods</p>
</blockquote>
<p>如果提示没有权限:</p>
<blockquote>
<p>终端输入：$ sudo gem install -n /usr/local/bin cocoapods</p>
</blockquote>
<p>安装完成之后再执行pod setup（PS：这个过程是漫长的，要有耐心,如果你是黑人脸的话，那基本就停在这了）</p>
<blockquote>
<p>终端输入：$ pod setup</p>
</blockquote>
<h2 id="4-pod-setup无法执行解决方案"><a href="#4-pod-setup无法执行解决方案" class="headerlink" title="4.pod setup无法执行解决方案"></a>4.pod setup无法执行解决方案</h2><h3 id="4-1-安装国内镜像源-但是目前没有找到国内仍在维护的镜像源"><a href="#4-1-安装国内镜像源-但是目前没有找到国内仍在维护的镜像源" class="headerlink" title="4.1 安装国内镜像源(但是目前没有找到国内仍在维护的镜像源)"></a>4.1 安装国内镜像源(但是目前没有找到国内仍在维护的镜像源)</h3><blockquote>
<p>pod repo remove master</p>
</blockquote>
<blockquote>
<p>pod repo add master <a href="https://git.coding.net/CocoaPods/Specs.git" target="_blank" rel="noopener">https://git.coding.net/CocoaPods/Specs.git</a></p>
</blockquote>
<blockquote>
<p>pod repo update</p>
</blockquote>
<h3 id="4-2-使用git-把镜像源克隆下来，然后放到-cocoapods-repos"><a href="#4-2-使用git-把镜像源克隆下来，然后放到-cocoapods-repos" class="headerlink" title="4.2 使用git 把镜像源克隆下来，然后放到~/.cocoapods/repos"></a>4.2 使用git 把镜像源克隆下来，然后放到~/.cocoapods/repos</h3><blockquote>
<p>git clone <a href="https://github.com/CocoaPods/Specs" target="_blank" rel="noopener">https://github.com/CocoaPods/Specs</a></p>
</blockquote>
<h3 id="4-3-从浏览器-https-github-com-CocoaPods-Specs-下载"><a href="#4-3-从浏览器-https-github-com-CocoaPods-Specs-下载" class="headerlink" title="4.3 从浏览器 https://github.com/CocoaPods/Specs 下载."></a>4.3 从浏览器 <a href="https://link.jianshu.com/?t=https://github.com/CocoaPods/Specs" target="_blank" rel="noopener">https://github.com/CocoaPods/Specs</a> 下载.</h3><p><img src="https://upload-images.jianshu.io/upload_images/1877622-b947ebd8335c8680.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/700" alt="img"></p>
<p>zip下载方式.png</p>
<p>使用ZIP下载的方式下载下来文件，解压到repos目录.</p>
<h3 id="4-4-如果你有同事的话，找他拷贝一份-cocoapods-repos目录下的文件（这种方法最轻松！！）"><a href="#4-4-如果你有同事的话，找他拷贝一份-cocoapods-repos目录下的文件（这种方法最轻松！！）" class="headerlink" title="4.4 如果你有同事的话，找他拷贝一份~/.cocoapods/repos目录下的文件（这种方法最轻松！！）"></a>4.4 如果你有同事的话，找他拷贝一份~/.cocoapods/repos目录下的文件（这种方法最轻松！！）</h3><p>之后 只需要cd ~/.cocoapods/repos/master路径，执行一步(如果.git不存在的话)</p>
<blockquote>
<p>​    git init</p>
</blockquote>
<h3 id="4-5-使用github客户端进行下载镜像源-博主目前就使用的这种方式，感觉十分好用"><a href="#4-5-使用github客户端进行下载镜像源-博主目前就使用的这种方式，感觉十分好用" class="headerlink" title="4.5 使用github客户端进行下载镜像源(博主目前就使用的这种方式，感觉十分好用)"></a>4.5 使用github客户端进行下载镜像源(博主目前就使用的这种方式，感觉十分好用)</h3><p><img src="https://upload-images.jianshu.io/upload_images/1877622-181805ef89d34a3f.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/174" alt="img"></p>
<p>github客户端</p>
<p>至此你的电脑上已经能够正常使用cocoapods了。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">jackfrow</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">11</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">5</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">4</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">jackfrow</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
